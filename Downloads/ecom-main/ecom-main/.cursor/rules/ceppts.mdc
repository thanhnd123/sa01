---
description: 
globs: 
alwaysApply: false
---

# ğŸ–¥ï¸ Thiáº¿t Káº¿ Photoshop Client Cho Há»‡ Thá»‘ng Server-Controlled API

Há»‡ thá»‘ng nÃ y giÃºp **Photoshop tá»± Ä‘á»™ng cháº¡y cÃ¡c lá»‡nh/script do server gá»­i xuá»‘ng**, phá»¥c vá»¥ cÃ¡c má»¥c Ä‘Ã­ch nhÆ°:

- Tá»± Ä‘á»™ng xá»­ lÃ½ áº£nh (crop, resize, export, v.v.).
- Äá»“ng bá»™ workflow tá»« backend.
- Trigger hÃ nh Ä‘á»™ng tá»« web/app vÃ o Photoshop.

---

## ğŸ§± Kiáº¿n TrÃºc Há»‡ Thá»‘ng

```
[Server API] â‡„ [CEP Extension trong Photoshop] â‡„ [ExtendScript]
```

- Server gá»­i JSON chá»©a lá»‡nh/script hoáº·c URL script.
- CEP Extension trong Photoshop liÃªn tá»¥c láº¯ng nghe (WebSocket hoáº·c polling).
- CEP gá»i `evalScript()` Ä‘á»ƒ cháº¡y script trong mÃ´i trÆ°á»ng Photoshop.

---

## ğŸ“ Cáº¥u TrÃºc ThÆ° Má»¥c CEP

```
PhotoshopClient/
â”œâ”€â”€ CSXS/
â”‚   â””â”€â”€ manifest.xml
â”œâ”€â”€ index.html
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ main.js
â”‚   â””â”€â”€ socket.js
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ jsx/
â”‚   â””â”€â”€ dispatcher.jsx
â””â”€â”€ CSInterface.js
```

---

## ğŸ“¡ Giao Tiáº¿p Vá»›i Server (Polling / WebSocket)

### 1. WebSocket máº«u (socket.js)

```js
let socket = new WebSocket("wss://yourserver.com/photoshop");

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === "script" && data.code) {
    new CSInterface().evalScript(data.code);
  }
};
```

### 2. Hoáº·c dÃ¹ng polling

```js
setInterval(async () => {
  const res = await fetch("https://yourserver.com/api/commands");
  const { code } = await res.json();
  if (code) {
    new CSInterface().evalScript(code);
  }
}, 5000);
```

---

## âœï¸ JSX Script Dispatcher (dispatcher.jsx)

```jsx
// MÃ£ script sáº½ Ä‘Æ°á»£c truyá»n trá»±c tiáº¿p tá»« server vÃ o evalScript
// VÃ­ dá»¥ payload:
// { "code": "app.activeDocument.resizeImage(UnitValue(800,'px'), null);" }
```

---

## âš™ï¸ main.js

```js
(function () {
  const cs = new CSInterface();
  // Load socket or polling logic
  loadJS("js/socket.js");
})();
```

---

## ğŸ”’ Báº£o Máº­t & Giá»›i Háº¡n

- NÃªn xÃ¡c thá»±c WebSocket báº±ng token khi káº¿t ná»‘i.
- Cáº©n trá»ng vá»›i lá»‡nh `evalScript(code)` â€“ chá»‰ cho phÃ©p cÃ¡c script tá»« nguá»“n tin cáº­y.
- CÃ³ thá»ƒ whitelist function (vÃ­ dá»¥: chá»‰ cho phÃ©p `resizeImage`, `exportPNG`).

---

## ğŸ› ï¸ TÃ­ch Há»£p vá»›i Server

Server backend sáº½ cáº§n:

- Endpoint gá»­i script hoáº·c gá»­i theo WebSocket.
- DB lÆ°u log task Ä‘Ã£ gá»­i.
- Token-based hoáº·c IP-restricted xÃ¡c thá»±c client CEP.

---

## ğŸ§ª VÃ­ Dá»¥ Script

```jsx
// Resize áº£nh vá» 800px chiá»u rá»™ng
app.activeDocument.resizeImage(UnitValue(800, "px"), null);

// Xuáº¥t file PNG
var opts = new PNGSaveOptions();
app.activeDocument.saveAs(new File("/c/temp/output.png"), opts, true);
```

---

## âœ… Æ¯u Äiá»ƒm

- Chá»§ Ä‘á»™ng tá»« server, khÃ´ng cáº§n thao tÃ¡c ngÆ°á»i dÃ¹ng.
- Giao tiáº¿p real-time (WebSocket).
- Má»Ÿ rá»™ng dá»… dÃ ng cho há»‡ thá»‘ng xá»­ lÃ½ áº£nh tá»± Ä‘á»™ng.

---

## âš ï¸ LÆ°u Ã

- CEP chá»‰ cháº¡y khi Photoshop má»Ÿ.
- MÃ¡y client cáº§n báº­t 24/7 náº¿u muá»‘n hoáº¡t Ä‘á»™ng liÃªn tá»¥c.
- Chá»‰ nÃªn cháº¡y script Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm duyá»‡t/kÃ½.

---

## ğŸ”— TÃ i NguyÃªn Tham Kháº£o

- [Adobe CEP Resources](https://github.com/Adobe-CEP)
- [CSInterface.js API](https://github.com/Adobe-CEP/CEP-Resources)
- [Photoshop Scripting Guide](https://www.adobe.com/content/dam/acom/en/devnet/photoshop/pdfs/photoshop-cc-javascript-ref-2020.pdf)

---
